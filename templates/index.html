<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>FNF JSON ã‚¿ã‚¤ãƒŸãƒ³ã‚°å¤‰æ›ãƒ„ãƒ¼ãƒ«</title>
  <style>
    body { background:#111; color:#eee; font-family:sans-serif; text-align:center; padding:20px; }
    input, button { margin:8px; padding:8px 12px; border:none; border-radius:5px; }
    button { background:#4caf50; color:#fff; cursor:pointer; }
    button:hover { background:#43a047; }
    #result { margin-top:20px; text-align:left; white-space:pre-wrap; background:#222; padding:10px; border-radius:8px; }
  </style>
</head>
<body>
  <h1>ğŸµ FNF JSON â†’ ç§’ãƒ»ã‚¿ã‚¤ãƒ—å¤‰æ›ãƒ„ãƒ¼ãƒ«</h1>
  <form id="form">
    <input type="file" id="jsonFile" accept=".json">
    <button type="submit">å¤‰æ›</button>
  </form>
  <div id="result"></div>

  <script>
    const form = document.getElementById('form');
    const result = document.getElementById('result');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const file = document.getElementById('jsonFile').files[0];
      if (!file) return alert('JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ã­');

      const fd = new FormData();
      fd.append('jsonFile', file);

      result.textContent = 'å¤‰æ›ä¸­...';
      const res = await fetch('/convert', { method: 'POST', body: fd });
      const data = await res.json();

      if (data.error) {
        result.textContent = 'âš ï¸ ã‚¨ãƒ©ãƒ¼: ' + data.error;
        return;
      }

      const text = `BPM: ${data.bpm}\n\n${data.converted.join('\n')}`;
      result.textContent = text;

      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'converted.txt';
      a.textContent = 'ğŸ“„ TXTã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰';
      result.appendChild(document.createElement('br'));
      result.appendChild(a);
    });
  </script>
</body>
</html>
